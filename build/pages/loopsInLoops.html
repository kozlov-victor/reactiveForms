<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RunCode</title>
    <script src="../reactiveForms.js"></script>
</head>
<body>

    

<div id="app">
    <ul>
        <li data-for="b,i in app.bundles">
            {{i+1}}. {{b.name}} <button data-click="app.removeExternal(i)">remove({{i}})</button>
            <ul>
                <li data-for="d,j in b.data">
                     {{j+1}}. {{d.slot}}
                    <button data-click="app.removeInternal(0,j)">remove({{i}},{{j}})</button>
                </li>
            </ul>
        </li>
    </ul>

    <button data-click="app.add()">+</button>

    <hr/>


    <button data-click="app.changeExternal()">Изменить внешнее значение</button>
    <button data-click="app.changeInternal()">Изменить вложенное значение</button>
    <button data-click="app.changeAll()">Изменить все (изменить по ссылке)</button>
    <button data-click="app.changeGlobal()">Изменить ссылку на объект</button>
</div>



    <script>
        
var app = {};
app.bundles = [
    {
        name:'Хранилище 1',
        data: [
            {'slot':12},
            {'slot':33}
        ]
    },
    {
        name:'Хранилище 2',
        data: [
            {'slot':4},
            {'slot':32}
        ]
    },
    {
        name:'Хранилище 3',
        data: [
            {'slot':2},
            {'slot':45}
        ]
    }
];

var rnd = function(){
    return Math.random().toFixed(3)
};

app.changeExternal = function(){
    for (var i=0;i<this.app.bundles.length;i++) {
        this.app.bundles[i].name = 'bundle_'+rnd();
    }
};

app.changeInternal = function(){
    for (var i=0;i<this.app.bundles.length;i++) {
        for (var j=0;j<this.app.bundles[i].data.length;j++) {
            this.app.bundles[i].data[j] = {slot:'slot_'+rnd()};
        }
    }
};

app.changeAll = function(){
    for (var i=0;i<this.app.bundles.length;i++) {
        this.app.bundles[i].name = 'bundle_'+rnd();
        for (var j=0;j<this.app.bundles[i].data.length;j++) {
            this.app.bundles[i].data[j] = {slot:'slot_'+rnd()};
        }
    }
};

app.add = function(){
    this.app.bundles.push({
        name:'Хранилище_'+rnd(),
        data: [
            {'slot':'sl_'+rnd()},
            {'slot':'sl_'+rnd()}
        ]
    });
};

app.removeExternal = function(i){
    this.app.bundles.splice(i,1);
};

app.removeInternal = function(i,j){
    this.app.bundles[i].data.splice(j);
};

app.changeGlobal = function(){

    this.app.bundles = [
        {
            name:'Хранилище 1'+rnd(),
            data: [
                {'slot':12+rnd()},
                {'slot':33+rnd()}
            ]
        },
        {
            name:'Хранилище 2'+rnd(),
            data: [
                {'slot':4+rnd()},
                {'slot':32+rnd()}
            ]
        },
        {
            name:'Хранилище 3'+rnd(),
            data: [
                {'slot':2+rnd()},
                {'slot':45+rnd()}
            ]
        }
    ];

};

RF.applyBindings('#app',{
    app:app
});
RF.run();
    </script>
</body>
</html>